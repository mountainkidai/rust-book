<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Ownership Inventory #2 - The Rust Programming Language</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="ferris.css">
        <link rel="stylesheet" href="theme/semantic-notes.css">
        <link rel="stylesheet" href="theme/listing.css">
        <link rel="stylesheet" href="theme/2018-edition.css">
        <link rel="stylesheet" href="js-extensions/packages/feedback/dist/index.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Programming Language</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="http://github.com/mountainkidai/rust-book/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="ownership-inventory-2"><a class="header" href="#ownership-inventory-2">Ownership Inventory #2</a></h2>
<p>The Ownership Inventory is a series of quizzes that test your understanding of ownership in real-world scenarios. These scenarios are inspired by common StackOverflow questions about Rust.</p>
<div class="quiz-placeholder" data-quiz-name="&quot;ch08-04-inventory&quot;" data-quiz-questions="{&quot;questions&quot;:[{&quot;context&quot;:&quot;The function `v.iter()` immutably borrows a vector `v` for the duration of the for-loop. However, `v.remove(i)` requires a mutable\nreference to `v`. Therefore `v.remove(i)` cannot borrow `v` as mutable, since that would conflict with the iterator.\n&quot;,&quot;id&quot;:&quot;867e5d29-c1eb-44b3-99e3-bb2325b74e44&quot;,&quot;type&quot;:&quot;MultipleChoice&quot;,&quot;answer&quot;:{&quot;answer&quot;:&quot;`v.remove(i)` cannot borrow `v` as mutable&quot;},&quot;prompt&quot;:{&quot;distractors&quot;:[&quot;`v` does not live long enough to call `v.remove(i)`&quot;,&quot;`t` cannot be dereferenced while `i` is live&quot;,&quot;`v.iter()` cannot be called on a mutable reference&quot;],&quot;prompt&quot;:&quot;**Program 1:**\n\n```ide\n/// Removes all the zeros in-place from a vector of integers.\nfn remove_zeros(v: &amp;mut Vec&lt;i32&gt;) {\n    for (i, t) in v.iter().enumerate().rev() {\n        if *t == 0 {\n            v.remove(i);\n            v.shrink_to_fit();\n        }\n    }\n}\n```\n\nIf you tried to compile this function, which of the following best describes the compiler error you would get?\n&quot;}},{&quot;context&quot;:&quot;To violate memory safety, `remove_zeros` must be called with a vector that contains a zero after the first element.\nThe call to `v.shrink_to_fit()` will deallocate memory owned by the vector (due to resizing), which will invalidate the\niterator `v.iter()` which contains a pointer to the old data. Note that reading the vector `v` after calling `remove_zeros`\nis not essential to the safety violation, since the issue is internal to `remove_zeros`.\n&quot;,&quot;id&quot;:&quot;dd1bd092-ef8d-4293-a4d6-6a59b5887e98&quot;,&quot;type&quot;:&quot;MultipleChoice&quot;,&quot;answer&quot;:{&quot;answer&quot;:[&quot;```\nlet mut v = vec![5, 5, 0];\nremove_zeros(&amp;mut v);\nprintln!(\&quot;{:?}\&quot;, v);\n```\n&quot;,&quot;```\nlet mut v = vec![1, 2, 0, 3];\nremove_zeros(&amp;mut v);\n```\n&quot;]},&quot;prompt&quot;:{&quot;distractors&quot;:[&quot;```\nlet mut v = vec![1; 100];\nremove_zeros(&amp;mut v);\n```\n&quot;,&quot;None of these programs&quot;],&quot;prompt&quot;:&quot;**Program 1:**\n\n```ide\n/// Removes all the zeros in-place from a vector of integers.\nfn remove_zeros(v: &amp;mut Vec&lt;i32&gt;) {\n    for (i, t) in v.iter().enumerate().rev() {\n        if *t == 0 {\n            v.remove(i);\n            v.shrink_to_fit();\n        }\n    }\n}\n```\n\nNormally if you try to compile this function, the compiler returns the following error:\n\n```text\nerror[E0502]: cannot borrow `*v` as mutable because it is also borrowed as immutable\n --&gt; test.rs:5:13\n  |\n3 |     for (i, t) in v.iter().enumerate().rev() {\n  |                   --------------------------\n  |                   |\n  |                   immutable borrow occurs here\n  |                   immutable borrow later used here\n4 |         if *t == 0 {\n5 |             v.remove(i);\n  |             ^^^^^^^^^^^ mutable borrow occurs here\n```\n\nAssume that the compiler did NOT reject this function. Which (if any) of the following programs would\n(1) pass the compiler, and (2) possibly cause undefined behavior if executed?\nCheck each program that satisfies both criteria, OR check \&quot;None of these programs\&quot; if none are satisfying.\n&quot;}},{&quot;context&quot;:&quot;Any strategy that requires allocating a new vector, either via `Vec::clone` or `Vec::new`, requires unnecessary additional allocation.\nTherefore the simplest strategy that works is to only iterate over the indices `0 .. v.len()` which does not borrow `v`. We do this\nin reverse order to avoid removing missing indexes.\n\nLike with Problem 1, the most idiomatic strategy is actually to use a built-in function we haven't discussed,\n[`Vec::retain`](https://doc.rust-lang.org/std/vec/struct.Vec.html#method.retain). This function keeps only elements in a vector\nthat pass a predicate, but does so with more memory-efficiency.\n&quot;,&quot;id&quot;:&quot;c7e7e1e1-2788-4dd9-9c18-436bc95b405f&quot;,&quot;type&quot;:&quot;MultipleChoice&quot;,&quot;answer&quot;:{&quot;answer&quot;:&quot;```ide\nfn remove_zeros(v: &amp;mut Vec&lt;i32&gt;) {\n    for `[i in (0 .. v.len()).rev()]` {\n        if `[v[i]]` == 0 {\n            v.remove(i);\n            v.shrink_to_fit();\n        }\n    }\n}\n```\n&quot;},&quot;prompt&quot;:{&quot;distractors&quot;:[&quot;```ide\nfn remove_zeros(v: &amp;mut Vec&lt;i32&gt;) {\n    for (i, t) in v`[.clone()]`.iter().enumerate().rev() {\n        if *t == 0 {\n            v.remove(i);\n            v.shrink_to_fit();\n        }\n    }\n}\n```\n&quot;,&quot;```ide\nfn remove_zeros(v: `[&amp;]`Vec&lt;i32&gt;) `[-&gt; Vec&lt;i32&gt;]` {\n    `[let mut new_vec = Vec::new();]`\n    for (i, t) in v.iter().enumerate().rev() {\n        if *t `[!=]` 0 {\n            `[new_vec.push(*t)]`\n        }\n    }\n    `[new_vec]`\n}\n```\n&quot;,&quot;```ide\nfn remove_zeros(v: `[Vec&lt;i32&gt;]`) {\n    for (i, t) in v.iter().enumerate().rev() {\n        if *t == 0 {\n            v.remove(i);\n            v.shrink_to_fit();\n        }\n    }\n}\n```\n&quot;],&quot;prompt&quot;:&quot;**Program 1:**\n\n```ide\n/// Removes all the zeros in-place from a vector of integers.\nfn remove_zeros(v: &amp;mut Vec&lt;i32&gt;) {\n    for (i, t) in v.iter().enumerate().rev() {\n        if *t == 0 {\n            v.remove(i);\n            v.shrink_to_fit();\n        }\n    }\n}\n```\n\nOf the following fixes (highlighted in yellow), which fix best satisfies these three criteria:\n1. The fixed function passes the Rust compiler,\n2. The fixed function preserves the intention of the original code, and\n3. The fixed function does not introduce unnecessary inefficiencies\n&quot;}},{&quot;context&quot;:&quot;The compiler does not consider the specific value of the indexes used to access an array, so `&amp;mut v[i]`\nand `&amp;mut v[n - i - 1]` are assumed to possibly refer to the same element. Therefore we get an error\nwhere `v` cannot be mutably borrowed twice.\n&quot;,&quot;id&quot;:&quot;fb0e3080-7cc8-4338-948e-fae693d137c8&quot;,&quot;type&quot;:&quot;MultipleChoice&quot;,&quot;answer&quot;:{&quot;answer&quot;:&quot;cannot borrow `v` as mutable twice for `v[i]` and `v[n - i - 1]`&quot;},&quot;prompt&quot;:{&quot;distractors&quot;:[&quot;cannot borrow `v` as immutable for `v.len()` when `v` is a mutable borrow&quot;,&quot;cannot mutably borrow an element `v[i]` of a mutable vector&quot;],&quot;prompt&quot;:&quot;**Program 2:**\n\n```ide\n/// Reverses the elements of a vector in-place\nfn reverse(v: &amp;mut Vec&lt;String&gt;) {\n    let n = v.len();\n    for i in 0 .. n / 2 {\n        std::mem::swap(&amp;mut v[i], &amp;mut v[n - i - 1]);\n    }\n}\n```\n\nIf you tried to compile this program, which of the following best describes the compiler error you would get?\n&quot;}},{&quot;context&quot;:&quot;This function cannot cause a memory safety violation because `i != n - i - 1` for all `i`, so the two\nmutable references always refer to different elements. Note that the `let x = &amp;v[0]` program would not\ncompile, as Rust's borrow checker would not allow `reverse` to be called while `x` is live.\n&quot;,&quot;id&quot;:&quot;4c703871-3cc3-483f-beb5-876bdbcd223b&quot;,&quot;type&quot;:&quot;MultipleChoice&quot;,&quot;answer&quot;:{&quot;answer&quot;:[&quot;None of these programs&quot;]},&quot;prompt&quot;:{&quot;distractors&quot;:[&quot;```\nlet mut v = vec![String::from(\&quot;a\&quot;), String::from(\&quot;b\&quot;)];\nlet x = &amp;v[0];\nreverse(&amp;mut v);\nprintln!(\&quot;{x}\&quot;);\n```\n&quot;,&quot;```\nlet mut v = vec![String::from(\&quot;a\&quot;), String::from(\&quot;b\&quot;)];\nreverse(&amp;mut v);\n```\n&quot;,&quot;```\nlet mut v = vec![String::from(\&quot;a\&quot;), String::from(\&quot;b\&quot;)];\nreverse(&amp;mut v);\nprintln!(\&quot;{:?}\&quot;, v);\n```\n&quot;],&quot;prompt&quot;:&quot;**Program 2:**\n\n```ide\n/// Reverses the elements of a vector in-place\nfn reverse(v: &amp;mut Vec&lt;String&gt;) {\n    let n = v.len();\n    for i in 0 .. n / 2 {\n        std::mem::swap(&amp;mut v[i], &amp;mut v[n - i - 1]);\n    }\n}\n```\n\nNormally if you try to compile this function, the compiler returns the following error:\n\n```text\nerror[E0499]: cannot borrow `*v` as mutable more than once at a time\n --&gt; test.rs:5:40\n  |\n5 |         std::mem::swap(&amp;mut v[i], &amp;mut v[n - i - 1]);\n  |         --------------      -          ^ second mutable borrow occurs here\n  |         |                   |\n  |         |                   first mutable borrow occurs here\n  |         first borrow later used by call\n```\n\nAssume that the compiler did NOT reject this function. Which (if any) of the following programs would\n(1) pass the compiler, and (2) possibly cause undefined behavior if executed?\nCheck each program that satisfies both criteria, OR check \&quot;None of these programs\&quot; if none are satisfying.\n&quot;}},{&quot;context&quot;:&quot;In a situation where the borrow checker rejects an operation that is actually safe and has no workaround, then\nunsafe code is sometimes acceptable if it's critical to avoid allocations. \nIn this specific case, you should actually use [`Vec::swap`](https://doc.rust-lang.org/std/vec/struct.Vec.html#method.swap), which is internally implemented\nwith heavily-tested `unsafe` code similar to the code above. \nBut in general, if the standard library doesn't happen to support your use case, then `unsafe` can be acceptable if used correctly.\n&quot;,&quot;id&quot;:&quot;380fc77f-190d-4386-9e0e-f9360bbbfd98&quot;,&quot;type&quot;:&quot;MultipleChoice&quot;,&quot;answer&quot;:{&quot;answer&quot;:&quot;```ide\nfn reverse(v: &amp;mut Vec&lt;String&gt;) {\n    let n = v.len();\n    for i in 0 .. n / 2 {\n        `[let p1 = &amp;mut v[i] as *mut String;]`\n        `[let p2 = &amp;mut v[n - i - 1] as *mut String;]`\n        `[unsafe { std::ptr::swap_nonoverlapping(p1, p2, 1); }]`\n    }\n}\n```\n&quot;},&quot;prompt&quot;:{&quot;distractors&quot;:[&quot;```ide\nfn reverse(v: &amp;mut Vec&lt;String&gt;) {\n    let n = v.len();\n    `[let mut v2 = v.clone();]`\n    for i in 0 .. n / 2 {\n        std::mem::swap(&amp;mut v[i], &amp;mut `[v2]`[n - i - 1]);\n    }\n}\n```\n&quot;,&quot;```ide\nfn reverse(v: `[&amp;Vec&lt;String&gt;]`) -&gt; `[Vec&lt;String&gt;]` {\n    let n = v.len();\n    `[let mut v2 = Vec::new();]`    \n    for _ in 0 .. `[n]` {\n        `[v2.push(v.pop().unwrap());]`\n    }\n    `[v2]`\n}\n```\n&quot;,&quot;```ide\nfn reverse(v: &amp;mut Vec&lt;String&gt;) {\n    let n = v.len();    \n    for i in 0 .. n / 2 {\n        `[let s1 = v[i].clone();]`\n        `[let s2 = v[n - i - 1].clone();]`\n        `[v[i] = s2;]`\n        `[v[n - i - 1] = s1;]`\n    }\n}\n```\n&quot;],&quot;prompt&quot;:&quot;**Program 2:**\n\n```ide\n/// Reverses the elements of a vector in-place\nfn reverse(v: &amp;mut Vec&lt;String&gt;) {\n    let n = v.len();\n    for i in 0 .. n / 2 {\n        std::mem::swap(&amp;mut v[i], &amp;mut v[n - i - 1]);\n    }\n}\n```\n\nOf the following fixes (highlighted in yellow), which fix best satisfies these three criteria:\n1. The fixed function passes the Rust compiler,\n2. The fixed function preserves the intention of the original code, and\n3. The fixed function does not introduce unnecessary inefficiencies\n&quot;}}]}" data-quiz-fullscreen="true" data-quiz-cache-answers="true"></div>
<script type="text/javascript" src="quiz/quiz-embed.iife.js"></script><link rel="stylesheet" type="text/css" href="quiz/style.css">
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch08-03-hash-maps.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="ch09-00-error-handling.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch08-03-hash-maps.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="ch09-00-error-handling.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="ferris.js"></script>
        <script src="js-extensions/packages/telemetry/dist/index.js"></script>
        <script src="js-extensions/packages/feedback/dist/index.js"></script>



    </div>
    </body>
</html>
